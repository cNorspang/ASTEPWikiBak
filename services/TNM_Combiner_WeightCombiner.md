---
title: TNM Combiner WeightCombiner
description: 
published: true
date: 2021-11-04T12:47:34.328Z
tags: tnm
editor: markdown
---

# The TNM Combiner
The **TNM combiner** takes a list of "_Microservices_", each containing information about the microservice, how the user prioritise the service and a _Transport Network Model_ (**TNM**) as input. The WeightCombiner combines the recieved models into a single model, accounting for the users preferences.

for more information check the [WeightCombiner documentation](https://daisy-git.cs.aau.dk/astep-2021/astep-6/-/wikis/home).

**Calculation**
 The weights on _nodes_ and _edges_ are combined using the following equation: 
  
  
  $$W_{r} = \sum_{i=1}^{n}W_{i}P_{i}$$
  
  Where:
  - $W_{r}$ is the combined weight of the _node_ or _edge_, $i$.
  - $W_i$ is the weight on the current _node_ or _edge_.
  	- Where $0 \le W_i \le 1$
  - $P_i$ is the priority of the current model, given by the user.
  	- Where $0 \le P_x \le 1$ and $\sum_{i = 1}^{n} P_i = 1$
  - $n$ is the number of models
  

## Content 
- [Input Format](#input-format)
- [Output Format](#output-format)
- [End Points](#endpoints)


## Input Format
The accepted _JSON_ input format:

```json
[
  {
    "name": <string>,
    "url": <string>,
    "userPref": <float>,
    "model": {
      "error_list": [],
      "meta_data": {
        "last_service": <string>,
        "priority": <int>
      },
      "vehicle": {
        "id": <int>,
        "data": {}
      },
      "nodes": {
        "<int>": {
          "node_id": <int>,
          "node_weight": <float>,
          "data": {
            "longitude": <float>,
            "latitude": <float>
          },
          "edges": {
            "<int>": {
              "edge_id": <int>,
              "to_node_id": <int>,
              "edge_weight": <float>,
              "data": {
                "road_name": <string>,
                "distance": <float>,
                "max_speed": <int>,
                "road_type": <string>
              }
            }
          }
        }
      }
    }
  }
]
```
## Output Format
The generated _JSON_ output generated by the weightCombiner:
```json
{
  "error_list": [],
  "meta_data": {
    "last_service": <string>,
    "priority": <float>
  },
  "vehicle": {
    "id": <int>,
    "data": {}
  },
  "nodes": {
    "<int>": {
      "node_id": <int>,
      "node_weight": <float>,
      "data": {
        "longitude": <float>,
        "latitude": <float>
      },
      "edges": {
        "<int>": {
          "edge_id": <int>,
          "to_node_id": <int>,
          "edge_weight": <float>,
          "data": {
            "road_name": <string>,
            "distance": <float>,
            "max_speed": <int>,
            "road_type": <string>
          }
        }
      }
    } 
  }
}
```


## Endpoints
The microservice has two endpoints:
- [Status](#Status)
- [Data](#Combine)

### Status
_Request type_:  **GET**

_Path_: “/”

#### Usage
Used to see if the server is running. Only used for debugging. 

If the server is running the result will be as follows:
```
The WeightCombiner is online!
```

### Combine
_Request type_:  **POST**

_Path_: “/”

#### Usage
The endpoint for combination expects a list of *microservice* (**MS**) objects within the request body. 

The accepted input format can be seen [here](#input-format).

The generated **TNM** output can be seen [here](#output-format).

 _In case of any errors, an error message will be returned (status code 400)._
